<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Faust architecture: Rust architecture files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Faust architecture
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Rust architecture files</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md442"></a> <a href="https://www.rust-lang.org">Rust</a> is a blazingly fast and memory-efficient language with no runtime or garbage collector, it can power performance-critical services, run on embedded devices, and easily integrate with other languages.</p>
<p>A <a href="https://github.com/grame-cncm/faust/tree/master-dev/compiler/generator/rust">Rust backend</a> allows to generate Rust code from the DSP program as a data structure (subtype of a <code>dsp</code> type) and a set of methods using this type. Several architecture files have been developed to use the resulting Rust code. <a href="https://faustdoc.grame.fr/manual/architectures/#rust-tools">Additional projects</a> can be used to ease integration in the Rust ecosystem.</p>
<h1><a class="anchor" id="autotoc_md443"></a>
faust2portaudiorust</h1>
<p>The <b>faust2portaudiorust</b> tool transforms a <a class="el" href="classFaust.html">Faust</a> DSP program into a ready-to-use Rust project which uses the <a href="http://portaudio.com">PortAudio library</a> for real-time audio rendering.</p>
<p><code>faust2portaudiorust [-source] [<a class="el" href="classFaust.html">Faust</a> options] &lt;file.dsp&gt;</code></p>
<p>Here are the available options:</p>
<ul>
<li><code>-source : only generates the source project</code></li>
<li><code>-help or -h : shows the different options</code></li>
</ul>
<p>By default, it will create a <code>file-portaudiorust</code> folder with the Rust project and compile it using <em>cargo</em>.</p>
<p>As usual with faust2xx tools, other <a class="el" href="classFaust.html">Faust</a> compiler specific options can be given to <b>faust2portaudiorust</b>, like <code>-vec -lv 1</code> to compile in vector mode.etc.</p>
<h1><a class="anchor" id="autotoc_md444"></a>
faust2jackrust</h1>
<p>The <b>faust2jackrust</b> tool transforms a <a class="el" href="classFaust.html">Faust</a> DSP program into a ready-to-use Rust project which uses <a href="https://jackaudio.org">JACK</a> for real-time audio rendering.</p>
<p><code>faust2jackrust [-source] [<a class="el" href="classFaust.html">Faust</a> options] &lt;file.dsp&gt;</code></p>
<p>Here are the available options:</p>
<ul>
<li><code>-source : only generates the source project.</code></li>
<li><code>-help or -h : shows the different options</code></li>
</ul>
<p>By default, it will create a <code>file-jackrust</code> folder with the Rust project and compile it using <em>cargo</em>.</p>
<p>As usual with faust2xx tools, other <a class="el" href="classFaust.html">Faust</a> compiler specific options can be given to <b>faust2jackrust</b>, like <code>-vec -lv 1</code> to compile in vector mode.etc.</p>
<h1><a class="anchor" id="autotoc_md445"></a>
Memory allocation issues</h1>
<p>A DSP can be large in memory and allocating it on the heap by using <a href="https://doc.rust-lang.org/std/boxed/struct.Box.html">Box</a> is often necessary to avoid stack overflows. Unfortunately, Rust does not have a native way to directly allocate on the heap, and <code>let dsp = Box::new(Dsp::new())</code> will only solve the problem in release build where the intermediary stack allocation will be optimized away.</p>
<p><a class="el" href="classFaust.html">Faust</a> fixes this problem with the help of the crate <a href="https://docs.rs/default-boxed/latest/default_boxed/">default-boxed</a> that generates a method that allocates a struct on the heap. When using the generated architecture files, the project is already configured to use this crate and directly allocate on the heap. If you are not using the generated architecture files, ensure that the <code>Cargo.toml</code> file building the generated code contains the dependency to <code>default-boxed</code> and the feature <code>default-boxed</code>:</p>
<div class="fragment"><div class="line">[dependencies]</div>
<div class="line">default-boxed = { version = &quot;0.2.0&quot;, optional = true }</div>
<div class="line"> </div>
<div class="line">[features]</div>
<div class="line">default = [&quot;default-boxed&quot;]</div>
<div class="line">default-boxed = [&quot;dep:default-boxed&quot;]</div>
</div><!-- fragment --><p>Then, allocate the DSP with <code>let dsp = Dsp::default_boxed()</code> instead of <code>let dsp = Box::new(Dsp::new())</code>.</p>
<p>This feature can be opted out by building without the <code>default-boxed</code> feature, for example with <code>--no-default-features</code>. This removes both the <code>default-boxed</code> dependency and the <code>::default_boxed()</code> method. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
